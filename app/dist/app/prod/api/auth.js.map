{"version":3,"sources":["../../../../prod/api/Auth.js"],"names":["router","factory","Factory","auth","getAuth","browser","db","getDbc","post","req","res","email","body","toString","password","login","flag","data","footPrint","createFootprint","session","user","id","console","log","json","msg","status","userId","name","signUp","get","result","setUpDb","dropTables","os","version","cipher","crypto","createCipher","decipher","createDecipher","encrypted","update","final","decrypted","footprint","sessionFootPrint","send","module","exports"],"mappings":"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","file":"Auth.js","sourcesContent":["import { Router } from 'express';\nimport { Factory } from '../Factory';\nimport { detect } from 'detect-browser';\nimport crypto from 'crypto';\nimport session from 'express-session';\n\n\n\n\n// config();\nlet router = Router();\n\n\nconst factory = new Factory();\nconst auth = factory.getAuth();\nlet browser = detect();\n\nlet db = factory\n    .getDbc();\n\n\n/**\n *  This endpoint authenticates a user using th user's password and email \n *  (Note: change method from get to post)\n *  PAYLOAD:\n * @method POST\n * @param String email\n * @param String password\n * \n * @returns JSON\n */\nrouter.post('/login', (req, res) => {\n\n    let email = req.body.email.toString();\n    let password = req.body.password.toString();\n\n    auth.login(email, password, (flag, data) => {\n\n        if (flag) {\n\n            if (typeof data !== 'undefined') {\n                // create session here \n                let footPrint = auth.createFootprint(email, password);\n                req.session.footPrint = footPrint;\n                req.session.user = {\n                    email,\n                    id: data[0].id,\n                    footPrint,\n                };\n\n                console.log(req.session.user.id);\n                \n                console.log(\"footprint\", req.session.footPrint)\n\n                res.json({\n                    msg: \"Login Succesful\",\n                    status: true,\n                    userId: data[0].id\n                });\n                return;\n\n            }\n\n            res.json({\n                msg: \"Login Error: Could not get user\",\n                status: false,\n            });\n\n            return;\n        }\n        if (flag === 'undefined' || flag == false) {\n            res.json({\n                msg: \"Login Error: please check credentials \",\n                status: false,\n            });\n        }\n\n    });\n\n});\n\n/**\n * This endpoint create a user account\n * \n * @method POST\n * \n * @param String email\n * @param String password\n * \n * @return JSON \n */\nrouter.post('/signup', (req, res) => {\n\n    // TODO validate and clean user date\n\n    let name = req.body.name.toString();\n    let email = req.body.email.toString();\n    let password = req.body.password.toString();\n\n    console.log(`parameters: ${name, email, password}`);\n\n    auth\n        .signUp(name, email, password, (flag, data) => {\n            if (flag) {\n\n                console.log(\"Value\" + data);\n                if (typeof data !== 'undefined') {\n                    console.log(\"Value\" + data);\n\n                    // create session here \n                    let footPrint = auth.createFootprint(email, password);\n                    req.session.footPrint  = footPrint;\n\n                    req.session.user = {\n                        email,\n                        id: data[0].id,\n                        footPrint,\n                    };\n                    console.log(\"footprint\", req.session.footPrint)\n                    res.json({\n                        msg: \"Sign Up Succesful\",\n                        status: true,\n                        userId: data[0].id\n\n                    });\n                    return;\n                }\n\n                res.json({\n                    msg: \"Login Error: Could not retrive user creds\",\n                    status: false,\n                });\n\n                return;\n\n            }\n\n            res.json({\n                msg: \"Login Error: please check credentials \",\n                status: false,\n            });\n        });\n\n});\n\nrouter.get('/dbsetup/:key', (req, res) => {\n\n    // let key = req.params.key.toString();\n\n    // if (key ===  \"123\"){\n\n\n\n\n    // let createDb = db.createDatabase();\n\n    // set up db\n    let result = db\n        .setUpDb();\n\n\n\n\n    if (result) {\n        res.json({\n            msg: true,\n        });\n    }\n\n    res.json({\n        msg: false,\n    });\n\n\n    // }\n});\n\n\nrouter.get('/cleardb', (req, res) => {\n\n    db.dropTables((result) => {\n        if (result != false) {\n\n            res.json({\n                msg: 'success',\n                status: false,\n            });\n            return;\n        }\n\n    });\n\n    res.json({\n        msg: 'error',\n        status: false,\n    });\n\n});\n\n\nrouter.get('/crypto', (req, res) => {\n\n    let email = 'bensoft2k5@gmail.com';\n    let password = 'admin';\n\n\n\n    const footPrint = email + password + browser.name + browser.os + browser.version;\n    const cipher = crypto.createCipher('aes192', email);\n    const decipher = crypto.createDecipher('aes192', email);\n\n    let encrypted = cipher.update(footPrint, 'utf8', 'hex');\n    encrypted += cipher.final('hex');\n    console.log(\"Encrypted: \" + encrypted);\n\n\n   \n    let decrypted = decipher.update(encrypted, 'hex', 'utf8');\n    decrypted += decipher.final('utf8');\n    console.log(\"Decrypted: \" + decrypted);\n\n    req.session.footprint = encrypted;\n    let sessionFootPrint = req.session.footprint;\n\n    if (sessionFootPrint === 'undefined'){\n        res.send(500, \"invalid session\"); \n        return;\n    }\n\n    res.json({\n        encrypted,\n        decrypted,\n        footprint: req.session.footprint,\n        });\n\n});\n\n\nrouter.get('/footprint', (req, res) => {\n    res.send(req.session.footprint);\n})\n\n\n\nmodule.exports = router;\n"]}