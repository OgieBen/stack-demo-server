{"version":3,"sources":["../../../../prod/auth/Auth.js"],"names":["browser","Auth","_dbc","DBHelper","email","password","callback","fetchUserQuery","name","text","values","toString","validate","getDb","queryWithConfig","err","result","console","error","stack","log","resultLength","rows","length","status","forEach","user","addUserQuery","login","flag","data","authenticate","addUser","footPrint","os","version","cipher","crypto","createCipher","process","env","salt","encrypted","update","final","decrypted","_answer","Answer","getId"],"mappings":"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","file":"Auth.js","sourcesContent":["\nimport { Answer } from '../data/model/Answer';\n// import { Factory } from '../Factory';\nimport { DBHelper } from '../data/db/DBHelper';\nimport crypto from 'crypto';\nimport { detect } from 'detect-browser';\n\nconst browser = detect();\n\nexport class Auth {\n\n\n\n\n    constructor() {\n        // this._factory = new Factory();\n        this._dbc = new DBHelper();\n    }\n\n\n    getDb() {\n        return this._dbc;\n    }\n\n    /**\n     * Authenticates users i.e. check if users are registered,\n     * then logs them in\n     * \n     * @param {String} email \n     * @param {String} passWord \n     * \n     * @returns {Boolean}\n     */\n    authenticate(email, password, callback) {\n        // let flag = false;\n        const fetchUserQuery = {\n            name: 'fetch-user',\n            text: 'SELECT * FROM users WHERE email = $1 AND  password = $2 ',\n            values: [email.toString(), password.toString()],\n        };\n\n        if (this.validate(email, password)) {\n\n            this\n                .getDb()\n                .queryWithConfig(fetchUserQuery, (err, result) => {\n                    if (err) {\n                        console.error(err.stack);\n                        console.log(\"Authentication failure\");\n                        callback(false);\n                        return;\n                    }\n\n                    const resultLength = result.rows.length;\n                    console.log(email + password);\n\n                    if (result.rows.length === 1) {\n                        let status = true;\n                        console.log(\"Authentication success\");\n                        callback(status, result.rows);\n\n                        result.rows.forEach((user) => {\n                            console.log(user);\n                        });\n                        return;\n                    }\n\n                    console.log(\"Authentication failure: Invalid User \" + resultLength);\n                    callback(false, 0);\n\n                });\n        }\n    }\n\n    /**\n     * Adds user to database\n     * \n     * @param {String} email \n     * @param {String} password \n     * \n     * @returns {Boolean}\n     */\n    addUser(name, email, password, callback) {\n        // let flag = false;\n\n        const addUserQuery = {\n            name: 'add-user',\n            text: 'INSERT INTO users(name, email, password) VALUES($1, $2, $3)',\n            values: [name, email, password],\n\n        };\n\n        this\n            .getDb()\n            .queryWithConfig(addUserQuery, (err, result) => {\n                if (err) {\n                    console.log(\"Could not sign up user\");\n                    callback(false);\n                    console.error(err.stack);\n                    return;\n                }\n\n                console.log(\"Added User sucessfully\");\n\n\n                // signs user in and creates a session\n                this.login(email, password, (flag, data) => {\n                    callback(flag, data);\n                });\n            });\n    }\n\n    /**\n     * Logs user into the platform\n     * \n     * @param {String} email \n     * @param {String} password \n     */\n    login(email, password, callback) {\n\n        // let flag = false;\n\n        this.authenticate(email, password, (flag, data) => {\n            if (flag) {\n                console.log(\"Login was sucessful\");\n            }\n            callback(flag, data);\n        });\n\n    }\n\n    /**\n     * Signs user up\n     * \n     * @param {String} name\n     * @param {String} email \n     * @param {String} password \n     * \n     * @returns {Boolean}\n     */\n    signUp(name, email, password, callback) {\n\n        if (this.validate(name, email, password)) {\n            return this.addUser(name, email, password, (flag, data) => {\n                if (flag) {\n                    callback(flag, data);\n                    return;\n                }\n                callback(false);\n            });\n        }\n\n        callback(false);\n\n    }\n\n\n    /**\n     * Validates parameters \n     * \n     * @param {String} email \n     * @param {String} password \n     * \n     * @returns {Boolean}\n     */\n    validate(name, email, password) {\n\n        return true;\n    }\n\n\n    createFootprint(email, password) {\n\n        const footPrint = email + password + browser.name + browser.os + browser.version;\n        const cipher = crypto.createCipher('aes192', process.env.salt);\n        \n        let encrypted = cipher.update(footPrint, 'utf8', 'hex');\n        encrypted += cipher.final('hex');\n        return encrypted;\n    }\n\n    checkUserSession(){\n\n       /*  const decipher = crypto.createDecipher('aes192', process.env.salt);\n        let decrypted = decipher.update(encrypted, 'hex', 'utf8');\n        decrypted += decipher.final('utf8'); */\n\n        console.log(\"Decrypted: \" + decrypted);\n    }\n\n\n    testModel() {\n        let _answer = new Answer(1, 2, \"\", \"\");   //new Answer(1, 2, \"\", \"\" );\n        return _answer.getId();\n    }\n}\n\n\n\n\n"]}