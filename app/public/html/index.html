<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Document</title>
</head>

<body>
    <form action="/api/v1/questions" method="POST">
        <label for="">Add a question</label>
        <input placeholder="user id" name="userId" type="text">
        <input placeholder="question" name="question" type="text">
        <input type="submit" value="submit question">
    </form>


    <br>

    <h1>Testing Add Answer</h1>
    <!-- <form action="/api/v1/questions/1/answers" method="POST">
        <label for="">Add Answer</label>
        <input placeholder="user Id" name="userId" type="text">
        <input placeholder="answer" name="answer" type="text">
        <input placeholder="question Id" name="questionId" type="text">
        <input type="submit" value="submit answer">
    </form> -->


    <br>

    <h1>Testing Signup</h1>

    <!-- <form action="/api/v1/auth/signup" method="POST">
        <label for="">Sign Up</label>
        <input placeholder="name" name="name" type="text">
        <input placeholder="Email" name="email" type="text">
        <input placeholder="Password" name="password" type="text">
        <input type="submit" value="submit answer">
    </form> -->


    <br>
    <h1>Testing Put</h1>
    <button id="put" type="submit"> Test Put</button>
    <input placeholder="Update entry" type="text" id="answer-content">


    <br><h1>For Testing Delete/Update</h1>
    <button id="delete" type="submit"> Test delete</button>
    <input id="delete-question" type="text" name="" id="">


    <br><h1>Upvote</h1>
    <button id="upvote-button" type="submit"> Upvote</button>
    <input placeholder="Answer Id" id="upvote-input-aId" type="text" name="" id="">
    <input placeholder="Question id" id="upvote-input-qId" type="text">


    <br><h1>Downvote</h1>
    <button id="downvote-button" type="submit"> Downvote</button>
    <input placeholder="Answer Id" id="downvote-input-aId" type="text" name="" id="">
    <input placeholder="Question id" id="downvote-input-qId" type="text">


    <br><br>
    <br><h1>Testing Add Comment</h1>
    <button id="add-comment-button" type="submit"> Add Comment</button>
    <input placeholder="Comment" id="add-comment-input" type="text" name="" id="">
    <input placeholder="Question id" id="add-comment-qId" type="text">
    <input placeholder="Answer Id" id="add-comment-input-aId" type="text">

    <br><br>
    <br><h1>Search</h1>
    <button id="search-button" type="submit"> search</button>
    <input placeholder="Comment" id="search-input" type="text" name="" id="">

    <br><br>
    <br><h1>Auth</h1>
    <button id="auth">Authorize</button>

    <script src="https://cdn.auth0.com/js/auth0/9.5.1/auth0.min.js"></script>
    <br>
    <script>

        // // Add anwser
        // $('#put').on('click', (event) => {

        //     let content = $('#answer-content').val();

        //     axios({
        //         method: 'put',
        //         url: '/api/v1/questions/1/answers/1',
        //         data: {
        //             questionId: 1,
        //             answerId: 1,
        //             accept: true,
        //             userId: 1,
        //             answer: content.toString(),


        //         }
        //     })
        //         .then(function (response) {
        //             console.log(response.data.msg);
        //             alert(response.data.msg + "");
        //         })
        //         .catch((e) => {
        //             console.error(e);
        //             alert(e + "");
        //         });
        // });



        // // Add comment
        // $('#add-comment-button').on('click', (event) => {

        //     let content = $('#add-comment-input').val();
        //     let questionId = $('#add-comment-qId').val();
        //     let answerId = $('#add-comment-input-aId').val();

        //     axios({
        //         method: 'post',
        //         url: `/api/v1/questions/${questionId}/answers/${answerId}/comments`,
        //         data: {
        //             answerId: answerId,
        //             userId: 1,
        //             comment: content.toString(),
        //         }
        //     })
        //         .then(function (response) {
        //             console.log(response.data.msg);
        //             alert(response.data.msg + "");
        //         })
        //         .catch((e) => {
        //             console.error(e);
        //             alert(e + "");
        //         });
        // });

        // // Upvote
        // $('#upvote-button').on('click', (event) => {

        //     let answerId = $('#upvote-input-aId').val();
        //     let questionId = $("#upvote-input-qId").val();

        //     axios({
        //         method: 'put',
        //         url: `/api/v1/questions/${questionId}/answers/${answerId}/upvote`,
        //         data: {
        //             answerId: answerId,
        //             userId: 1,
        //         }
        //     })
        //         .then(function (response) {
        //             console.log(response.data.msg);
        //             alert(response.data.msg + "");
        //         })
        //         .catch((e) => {
        //             console.error(e);
        //             alert(e + "");
        //         });
        // });

        // // downvote
        // $('#downvote-button').on('click', (event) => {

        //     let answerId = $('#downvote-input-aId').val();
        //     let questionId = $("#downvote-input-qId").val();

        //     axios({
        //         method: 'put',
        //         url: `/api/v1/questions/${questionId}/answers/${answerId}/downvote`,
        //         data: {
        //             answerId: answerId,
        //             userId: 1,
        //         }
        //     })
        //         .then(function (response) {
        //             console.log(response.data.msg);
        //             alert(response.data.msg + "");
        //         })
        //         .catch((e) => {
        //             console.error(e);
        //             alert(e + "");
        //         });
        // });

        // // Delete Question
        // $('#delete').on('click', (event) => {

        //     let questionId = $('#delete-question').val();


        //     axios({
        //         method: 'delete',
        //         url: `/api/v1/questions/${questionId}`,
        //         data: {
        //             questionId: questionId,
        //             answerId: 1,
        //             accept: false,
        //             userId: 1,

        //         }
        //     })
        //         .then(function (response) {
        //             console.log(response.data.msg);
        //             alert(response.data.msg + "");
        //         })
        //         .catch((e) => {
        //             console.error(e);
        //             alert(e + "");
        //         });
        // });

        // // Delete Question
        // $('#search-button').on('click', (event) => {

        //     let searchKey = $('#search-input').val();


        //     axios({
        //         method: 'post',
        //         url: `/api/v1/questions/search`,
        //         data: {
        //             searchKey: searchKey,

        //         }
        //     })
        //         .then(function (response) {
        //             //console.log(response.data.msg);
        //             //console.log(response.data.data);
        //             let data  = response.data.data;
        //             data.forEach(element => {
        //                 console.log(element)
        //             });
        //             alert(response.data.data[0] + "");
        //         })
        //         .catch((e) => {
        //             console.error(e);
        //             alert(e + "");
        //         });
        // });


        function getToken(callback) {
            let settings = {
                "async": true,
                "crossDomain": true,
                "url": "https://slackdemo.auth0.com/oauth/token",
                "method": "POST",
                "headers": {
                    "content-type": "application/json",
                    "Access-Control-Allow-Origin": '*',
                    "Vary": 'origin',
                },
                "data": "{\"client_id\":\"xGFdSS7MqQcFdkQ1jlN9wyMQlN4kaxGl\",\"client_secret\":\"vLzgak5QIaTwtMi-HSED6r9yv-He0cIWo838WvD0drmP3roAkzBXYJmaPwBCcI13\",\"audience\":\"https://slackdemo-api.herokuapp.com/\",\"grant_type\":\"client_credentials\"}"


            }

            // "data": {
            //     "client_id": "xGFdSS7MqQcFdkQ1jlN9wyMQlN4kaxGl",
            //     "client_secret": "vLzgak5QIaTwtMi-HSED6r9yv-He0cIWo838WvD0drmP3roAkzBXYJmaPwBCcI13",
            //     "audience": "https://slackdemo.auth0.com/api/v2/",
            //     "grant_type": "client_credentials"
            // }

            axios(settings)
                .then((response) => {
                    callback(response);
                })
                .catch((err) => {
                    alert(err);
                });



            /*     // Add anwser
                $('#put').on('click', (event) => {
    
                    let content = $('#answer-content').val();
    
                    let token = getCurrentToken(webAuth);
                    if (token != 0) {
                        alert(token);
                        axios({
                            method: 'put',
                            url: '/api/v1/questions/1/answers/1',
                            authorization: `Bearer ${token}`,
                            data: {
                                questionId: 1,
                                answerId: 1,
                                accept: true,
                                userId: 1,
                                answer: content.toString(),
    
                            }
                        })
                            .then(function (response) {
                                console.log(response.data.msg);
                                alert(response.data.msg + "");
                            })
                            .catch((e) => {
                                console.error(e);
                                alert(e + "");
                            });
                    } else {
                        alert("Error Sending Request!");
                    }
    
    
                });
    
     */
        }


        window.addEventListener('load', function () {



            var webAuth = new auth0.WebAuth({
                domain: 'slackdemo.auth0.com',
                clientID: 'XL47kYbE2hQy4N6QiDSeKn4gp41zFlVh',
                responseType: 'token id_token',
                audience: 'https://slackdemo.auth0.com/userinfo',
                scope: 'openid',
                redirectUri: window.location.href
            });

            $("#auth").on('click', (event) => {
                webAuth.authorize();
            });





            // Add anwser
            $('#put').on('click', (event) => {

                let content = $('#answer-content').val();
                let token;

                webAuth.parseHash(function (err, authResult) {
                    if (authResult && authResult.accessToken && authResult.idToken) {
                        alert(authResult.accessToken);
                        token = authResult.accessToken;
                        if (token != 'undefined') {
                            alert(token);
                            axios({
                                method: 'put',
                                url: '/api/v1/questions/1/answers/1',
                                authorization: `Bearer ${token}`,
                                data: {
                                    questionId: 1,
                                    answerId: 1,
                                    accept: true,
                                    userId: 1,
                                    answer: content.toString(),

                                }
                            })
                                .then(function (response) {
                                    console.log(response.data.msg);
                                    alert(response.data.msg + "");
                                })
                                .catch((e) => {
                                    console.error(e);
                                    alert(e + "");
                                });
                        } else {
                            alert("Error Sending Request!");
                        }
                    } else if (err) {
                        alert(
                            'Error: ' + err.error + '. Check the console for further details.'
                        );
                    }
                });





            });



        });

        function getCurrentToken(webAuth) {


        }





        // Add comment
        $('#add-comment-button').on('click', (event) => {

            let content = $('#add-comment-input').val();
            let questionId = $('#add-comment-qId').val();
            let answerId = $('#add-comment-input-aId').val();

            axios({
                method: 'post',
                url: `/api/v1/questions/${questionId}/answers/${answerId}/comments`,
                data: {
                    answerId: answerId,
                    userId: 1,
                    comment: content.toString(),
                }
            })
                .then(function (response) {
                    console.log(response.data.msg);
                    alert(response.data.msg + "");
                })
                .catch((e) => {
                    console.error(e);
                    alert(e + "");
                });
        });

        // Upvote
        $('#upvote-button').on('click', (event) => {

            let answerId = $('#upvote-input-aId').val();
            let questionId = $("#upvote-input-qId").val();

            axios({
                method: 'put',
                url: `/api/v1/questions/${questionId}/answers/${answerId}/upvote`,
                data: {
                    answerId: answerId,
                    userId: 1,
                }
            })
                .then(function (response) {
                    console.log(response.data.msg);
                    alert(response.data.msg + "");
                })
                .catch((e) => {
                    console.error(e);
                    alert(e + "");
                });
        });

        // downvote
        $('#downvote-button').on('click', (event) => {

            let answerId = $('#downvote-input-aId').val();
            let questionId = $("#downvote-input-qId").val();

            axios({
                method: 'put',
                url: `/api/v1/questions/${questionId}/answers/${answerId}/downvote`,
                data: {
                    answerId: answerId,
                    userId: 1,
                }
            })
                .then(function (response) {
                    console.log(response.data.msg);
                    alert(response.data.msg + "");
                })
                .catch((e) => {
                    console.error(e);
                    alert(e + "");
                });
        });

        // Delete Question
        $('#delete').on('click', (event) => {

            let questionId = $('#delete-question').val();


            axios({
                method: 'delete',
                url: `/api/v1/questions/${questionId}`,
                data: {
                    questionId: questionId,
                    answerId: 1,
                    accept: false,
                    userId: 1,

                }
            })
                .then(function (response) {
                    console.log(response.data.msg);
                    alert(response.data.msg + "");
                })
                .catch((e) => {
                    console.error(e);
                    alert(e + "");
                });
        });

        // Delete Question
        $('#search-button').on('click', (event) => {

            let searchKey = $('#search-input').val();


            axios({
                method: 'post',
                url: `/api/v1/questions/search`,
                data: {
                    searchKey: searchKey,

                }
            })
                .then(function (response) {
                    //console.log(response.data.msg);
                    //console.log(response.data.data);
                    let data = response.data.data;
                    data.forEach(element => {
                        console.log(element)
                    });
                    alert(response.data.data[0] + "");
                })
                .catch((e) => {
                    console.error(e);
                    alert(e + "");
                });
        });

    </script>
</body>

</html>